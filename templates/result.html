<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>è¾¨è­˜çµæœ</title>
<style>
  /* ===============================
		é é¢æ•´é«”æ¨£å¼è¨­å®š
     =============================== */
  body {
    font-family: Arial, sans-serif;
    background: #f5f6f7;
    padding: 20px;
    text-align: center;
  }

  /* æ¨™é¡Œèˆ‡èªªæ˜æ–‡å­— */
  h1 { font-size: 30px; margin-bottom: 12px; }
  p  { font-size: 20px; color: #2b6f97; margin-bottom: 24px; }

  /* åœ–ç‰‡æ’åˆ—å€ï¼ˆä¸¦æ’æ’åˆ—å…©å¼µåœ–ï¼‰ */
  .row {
    display: flex;
    gap: 20px;
    justify-content: space-between;
    flex-wrap: wrap; /* æ‰‹æ©Ÿæ™‚è‡ªå‹•æ›è¡Œ */
  }

  /* å–®å¼µåœ–ç‰‡å¡ç‰‡å€å¡Š */
  .card {
    flex: 1 1 48%;
    box-sizing: border-box;
    border: 2px solid #ccc;
    padding: 10px;
    border-radius: 10px;
    background: #fff;
    text-align: center;
  }

  /* åœ–ç‰‡å¤–å±¤å®¹å™¨ */
  .img-wrap {
    position: relative;
    width: 100%;
    height: auto;
    overflow: hidden;
  }

  /* çµæœåœ–ç‰‡æ¨£å¼ */
  .result-img {
    width: 100%;
    height: auto;
    object-fit: contain;
    border-radius: 6px;
    cursor: grab;
    transition: transform 0.2s ease;
  }

  /*  å…¨è¢å¹•é¡¯ç¤ºæ¨£å¼ï¼ˆé»æ“Šåœ–ç‰‡æ”¾å¤§ç”¨ï¼‰ */
  .fullscreen {
    position: fixed !important;
    top: 0; left: 0;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0,0,0,0.95);
    z-index: 999;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: grab;
  }

  /* è¿”å›é¦–é æŒ‰éˆ•æ¨£å¼ */
  .btn {
    margin-top: 20px;
    padding: 12px 24px;
    background: #967AA1;
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-size: 18px;
    display: inline-block;
  }
</style>
</head>
<body>

<h1>è¾¨è­˜å®Œæˆ âœ…</h1>
<p>ä»¥ä¸‹æ˜¯è¾¨è­˜çµæœ</p>

<div class="row">
  {% if show_original %}
  <div class="card">
    <h2>è¼¸å…¥åœ–ç‰‡</h2>
    <div class="img-wrap">
      <img id="inputImage" class="result-img" src="{{ input_image }}">
    </div>
  </div>
  {% endif %}

  {% if show_circle %}
  <div class="card">
    <h2>åœˆåœ–çµæœ</h2>
    <div class="img-wrap">
      <img id="detectedImage" class="result-img" src="{{ detected_image }}">
    </div>
  </div>
  {% endif %}
</div>

<div class="card" style="margin-top:20px;">
  <h2>è¾¨è­˜æ–‡å­—</h2>
  <p>{{ objects_text }}</p>
</div>
<!-- ===============================
     ğŸ’¾ å„²å­˜è¾¨è­˜çµæœè¡¨å–®
     - æäº¤å¾Œç”±å¾Œç«¯å„²å­˜åˆ°ä½¿ç”¨è€…çš„æˆ‘çš„çµæœ
     =============================== -->
<form method="post" action="{{ url_for('save_result') }}" style="margin-top: 20px; text-align: center;">
  <input type="hidden" name="input_image" value="{{ input_image or '' }}">
  <input type="hidden" name="detected_image" value="{{ detected_image or '' }}">
  <input type="hidden" name="objects_text" value="{{ objects_text or '' }}">
  <input type="hidden" name="original_filename" value="{{ original_filename or '' }}">
  <input type="hidden" name="counts_json" value="{{ counts_json or '' }}">

  <!-- å„²å­˜æŒ‰éˆ• -->
  <div style="display: inline-flex; gap: 15px;">
    <button type="submit" style="
        padding: 10px 20px;
        border: 2px solid #10b981;
        border-radius: 8px;
        background: #10b981;
        color: #fff;
        font-size: 15px;
        cursor: pointer;
        transition: 0.25s;">
      ğŸ’¾ å„²å­˜åˆ°æˆ‘çš„çµæœ
    </button>
<!--
    <a href="{{ url_for('history_page') }}" style="
        padding: 10px 20px;
        border: 2px solid #2563eb;
        border-radius: 8px;
        background: #fff;
        color: #2563eb;
        font-size: 15px;
        text-decoration: none;
        display: inline-block;
        transition: 0.25s;">
      ğŸ“ æŸ¥çœ‹æˆ‘çš„çµæœ
    </a>
	-->
  </div>
</form>

<style>
button:hover {
  background: #0ea774;
  border-color: #0ea774;
}
a:hover {
  background: #2563eb;
  color: #fff;
  border-color: #2563eb;
}
</style>

<a href="/" class="btn">è¿”å›é¦–é </a>

<!-- ===============================
     - æä¾›åœ–ç‰‡æ”¾å¤§ã€æ‹–æ›³ã€é›™æ“Šé—œé–‰å…¨è¢å¹•
     - æ”¯æ´æ»‘é¼ æ»¾è¼ªç¸®æ”¾èˆ‡æ‰‹æ©Ÿé›™æŒ‡ç¸®æ”¾
     =============================== -->
<script>
let scale = 1;				 // ç¸®æ”¾æ¯”ä¾‹
let offsetX = 0, offsetY = 0;// æ‹–æ›³åç§»é‡
let isDragging = false;
let dragStartX, dragStartY;

// å–å¾—æ‰€æœ‰çµæœåœ–ç‰‡
const imgs = document.querySelectorAll(".result-img");

/* é»æ“Šåœ–ç‰‡ â†’ é€²å…¥å…¨è¢å¹•æª¢è¦–æ¨¡å¼ */
imgs.forEach(img => {
    img.addEventListener("click", () => {
        if (!img.classList.contains("fullscreen")) {
            img.classList.add("fullscreen");
            scale = 1; offsetX = 0; offsetY = 0;
            img.style.transform = "translate(0px,0px) scale(1)";
        }
    });
	
    /* é›™æ“Šåœ–ç‰‡ â†’ é›¢é–‹å…¨è¢å¹• */
    img.addEventListener("dblclick", () => {
        img.classList.remove("fullscreen");
        scale = 1; offsetX = 0; offsetY = 0;
        img.style.transform = "translate(0px,0px) scale(1)";
    });
	
    /* æ»‘é¼ æŒ‰ä¸‹ â†’ æº–å‚™æ‹–æ›³ */
    img.addEventListener("mousedown", (e) => {
        if (!img.classList.contains("fullscreen")) return;
        isDragging = true;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        e.preventDefault();
    });
});

/* æ»‘é¼ æ‹–æ›³åœ–ç‰‡ç§»å‹• */
window.addEventListener("mousemove", (e) => {
    const fullscreenImg = document.querySelector(".fullscreen");
    if (!isDragging || !fullscreenImg) return;
    let dx = e.clientX - dragStartX;
    let dy = e.clientY - dragStartY;
    offsetX += dx;
    offsetY += dy;
    fullscreenImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    dragStartX = e.clientX;
    dragStartY = e.clientY;
});

/* æ»‘é¼ æ”¾é–‹åœæ­¢æ‹–æ›³ */
window.addEventListener("mouseup", () => { isDragging = false; });

/* Ctrl + æ»¾è¼ªç¸®æ”¾åœ–ç‰‡ */
window.addEventListener("wheel", e => {
    const fullscreenImg = document.querySelector(".fullscreen");
    if (!fullscreenImg) return;
    if (!e.ctrlKey) return;
    e.preventDefault();
    scale += e.deltaY * -0.01;
    scale = Math.min(Math.max(0.5, scale), 20);
    fullscreenImg.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
}, { passive: false });

/* è¦–çª—å¤§å°æ”¹è®Šæ™‚ç¶­æŒåœ–ç‰‡ä½ç½® */
window.addEventListener("resize", () => {
    document.querySelectorAll(".fullscreen").forEach(img => {
        img.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    });
});

/* ===============================
		æ‰‹æ©Ÿé›™æŒ‡ç¸®æ”¾æ”¯æ´
   =============================== */
let lastTouchDistance = 0;
window.addEventListener("touchstart", e => {
    if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        lastTouchDistance = Math.hypot(dx, dy);
    }
}, { passive: false });

window.addEventListener("touchmove", e => {
    const fullscreenImg = document.querySelector(".fullscreen");
    if (!fullscreenImg || e.touches.length < 2) return;
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const newDistance = Math.hypot(dx, dy);
	// è‹¥å…©æŒ‡è·é›¢æ˜é¡¯è®ŠçŸ­ â†’ é›¢é–‹å…¨è¢å¹•
    if (newDistance < lastTouchDistance * 0.7) {
        fullscreenImg.classList.remove("fullscreen");
        scale = 1; offsetX = 0; offsetY = 0;
        fullscreenImg.style.transform = "translate(0px,0px) scale(1)";
    }
}, { passive: false });
</script>
</body>
</html>
